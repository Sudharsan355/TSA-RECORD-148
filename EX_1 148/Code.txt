import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
from scipy.stats import zscore
file_path = "/content/NIFTY 50.csv"
df = pd.read_csv(file_path, parse_dates=["Date"], index_col="Date")
print(df.info())
print(df.head())
print(df.isnull().sum())
df.fillna(method="ffill", inplace=True)
df.dropna(inplace=True)
z_scores = np.abs(zscore(df[["Open", "High", "Low", "Close"]]))
threshold = 3
outlier_mask = (z_scores < threshold).all(axis=1)
print(f"Number of outliers detected using Z-score: {(~outlier_mask).sum()}")

numerical_cols = ["Open", "High", "Low", "Close"]
Q1 = df[numerical_cols].quantile(0.25)
Q3 = df[numerical_cols].quantile(0.75)
IQR = Q3 - Q1
lower_bound = Q1 - 1.5 * IQR
upper_bound = Q3 + 1.5 * IQR

outliers = df[numerical_cols].apply(lambda x: (x < lower_bound[x.name]) | (x > upper_bound[x.name]), axis=0)

median_value = df[numerical_cols].median()
df[numerical_cols] = df[numerical_cols].mask(outliers, median_value, axis=1)

print(df.head())
plt.figure(figsize=(12, 6))
#plt.plot(df.index, df["Original Close"], label="Original Closing Price", color="red", linestyle="dashed", alpha=0.6)
plt.plot(df.index, df["Close"], label="Transformed Closing Price", color="blue", linewidth=2)
plt.xlabel("Date")
plt.ylabel("Closing Price")
plt.title("NIFTY 50 Time Series Analysis: Original vs. Transformed Data")
plt.legend()
plt.grid()
plt.show()